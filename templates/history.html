{% extends "base.html" %}

{% block title %}Historique - Prospector{% endblock %}

{% block content %}
<div class="card">
    <h2 style="margin-bottom: 20px;">âœ… Emails envoyÃ©s</h2>
    
    {% if sent_drafts %}
        <table>
            <thead>
                <tr>
                    <th>Date d'envoi</th>
                    <th>Destinataire</th>
                    <th>Sujet</th>
                    <th>ğŸ“­ Ouvert</th>
                    <th>ğŸ’¬ RÃ©ponse</th>
                    <th>ğŸ”„ Relances</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for draft in sent_drafts %}
                <tr>
                    <td>
                        {% if draft.sent_at %}
                            {{ draft.sent_at.strftime('%d/%m/%Y %H:%M') if draft.sent_at is not string else draft.sent_at }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ draft.to }}</td>
                    <td>{{ draft.subject }}</td>
                    <td>
                        {% if draft.open_count and draft.open_count > 0 %}
                            <span style="color: #27ae60; font-weight: bold;">
                                âœ“ {{ draft.open_count }}x
                            </span>
                            {% if draft.first_opened_at %}
                                <br><small style="color: #7f8c8d;">{{ draft.first_opened_at.strftime('%d/%m %H:%M') if draft.first_opened_at is not string else draft.first_opened_at }}</small>
                            {% endif %}
                        {% else %}
                            <span style="color: #95a5a6;">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if draft.has_reply %}
                            <span style="color: #27ae60; font-weight: bold;">âœ“ Oui</span>
                            {% if draft.reply_received_at %}
                                <br><small style="color: #7f8c8d;">{{ draft.reply_received_at.strftime('%d/%m %H:%M') if draft.reply_received_at is not string else draft.reply_received_at }}</small>
                            {% endif %}
                        {% else %}
                            <span style="color: #95a5a6;">Non</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if draft.total_followups and draft.total_followups > 0 %}
                            <div style="font-size: 12px;">
                                {% if draft.sent_followups and draft.sent_followups > 0 %}
                                    <span style="color: #27ae60;">âœ“ {{ draft.sent_followups }} envoyÃ©e(s)</span><br>
                                {% endif %}
                                {% if draft.scheduled_followups and draft.scheduled_followups > 0 %}
                                    <span style="color: #f39c12;">â± {{ draft.scheduled_followups }} planifiÃ©e(s)</span><br>
                                {% endif %}
                                {% if draft.cancelled_followups and draft.cancelled_followups > 0 %}
                                    <span style="color: #95a5a6;">âœ— {{ draft.cancelled_followups }} annulÃ©e(s)</span>
                                {% endif %}
                            </div>
                        {% else %}
                            <span style="color: #95a5a6;">-</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ url_for('view_sent_draft', draft_id=draft.id) }}" class="btn btn-primary" style="font-size: 12px; padding: 6px 12px;">ğŸ‘ï¸ DÃ©tails</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <p>Aucun email envoyÃ© pour le moment</p>
        </div>
    {% endif %}
</div>

<div class="card">
    <h2 style="margin-bottom: 20px;">âŒ Drafts rejetÃ©s</h2>
    
    {% if rejected_drafts %}
        <table>
            <thead>
                <tr>
                    <th>Date de rejet</th>
                    <th>Date de crÃ©ation</th>
                    <th>Destinataire</th>
                    <th>Sujet</th>
                </tr>
            </thead>
            <tbody>
                {% for draft in rejected_drafts %}
                <tr>
                    <td>
                        {% if draft.rejected_at %}
                            {{ draft.rejected_at.strftime('%d/%m/%Y %H:%M') if draft.rejected_at is not string else draft.rejected_at }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if draft.created_at %}
                            {{ draft.created_at.strftime('%d/%m/%Y %H:%M') if draft.created_at is not string else draft.created_at }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ draft.to }}</td>
                    <td>{{ draft.subject }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-state">
            <p>Aucun draft rejetÃ© pour le moment</p>
        </div>
    {% endif %}
</div>

<div style="margin-top: 20px;">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">â† Retour aux drafts en attente</a>
</div>
{% endblock %}
